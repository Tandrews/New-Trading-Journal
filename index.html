<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Professional Trading Journal with Portfolio Performance Dashboard">
    <title>Trading Journal - Portfolio Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- App Header -->
    <header class="app-header">
        <div class="container">
            <h1>üíº Trading Journal with Portfolio Dashboard</h1>
            <p>Professional options trading journal with real-time portfolio tracking and analytics</p>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="dashboard">üìä Dashboard</button>
            <button class="tab-btn" data-tab="add-trade">‚ûï Add Trade</button>
            <button class="tab-btn" data-tab="history">üìã Trade History</button>
            <button class="tab-btn" data-tab="import">üì• Import/Export</button>
        </div>

        <!-- ========================================
             DASHBOARD TAB
             ======================================== -->
        <div id="dashboard-tab" class="tab-content active">
            <!-- Trading Metrics Cards -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <h4>Total Trades</h4>
                    <div class="value" id="total-trades">0</div>
                </div>
                <div class="metric-card">
                    <h4>Total P&L</h4>
                    <div class="value" id="total-pl">$0.00</div>
                </div>
                <div class="metric-card">
                    <h4>Win Rate</h4>
                    <div class="value" id="win-rate">0%</div>
                </div>
                <div class="metric-card">
                    <h4>Total Wins</h4>
                    <div class="value" id="total-wins">0</div>
                </div>
                <div class="metric-card">
                    <h4>Total Losses</h4>
                    <div class="value" id="total-losses">0</div>
                </div>
                <div class="metric-card">
                    <h4>Average Win</h4>
                    <div class="value" id="average-win">$0.00</div>
                </div>
                <div class="metric-card">
                    <h4>Average Loss</h4>
                    <div class="value" id="average-loss">$0.00</div>
                </div>
                <div class="metric-card">
                    <h4>Largest Win</h4>
                    <div class="value" id="largest-win">$0.00</div>
                </div>
                <div class="metric-card">
                    <h4>Largest Loss</h4>
                    <div class="value" id="largest-loss">$0.00</div>
                </div>
                <div class="metric-card">
                    <h4>Profit Factor</h4>
                    <div class="value" id="profit-factor">0.00</div>
                </div>
            </div>

            <!-- Charts Grid -->
            <div class="charts-grid">
                <div class="chart-container">
                    <h3>üìà Trading P&L Over Time</h3>
                    <canvas id="pl-over-time"></canvas>
                </div>
                <div class="chart-container">
                    <h3>üíº Portfolio Balance</h3>
                    <canvas id="portfolio-balance"></canvas>
                </div>
                <div class="chart-container">
                    <h3>üìä Strategy Performance</h3>
                    <canvas id="strategy-performance"></canvas>
                </div>
                <div class="chart-container">
                    <h3>üéØ Top Tickers</h3>
                    <canvas id="top-tickers"></canvas>
                </div>
                <div class="chart-container">
                    <h3>üìÖ Monthly P&L</h3>
                    <canvas id="monthly-pl"></canvas>
                </div>
            </div>

            <!-- Portfolio Performance Section -->
            <div class="portfolio-performance-section">
                <div class="section-header">
                    <h2>üíº Portfolio Performance</h2>
                    <button class="btn btn-primary btn-sm" onclick="openPortfolioSettings()">
                        ‚öôÔ∏è Portfolio Settings
                    </button>
                </div>

                <!-- Portfolio Overview Cards -->
                <div class="portfolio-cards-grid">
                    <div class="metric-card portfolio-card">
                        <div class="card-icon">üè¶</div>
                        <div class="card-content">
                            <div class="card-label">Starting Capital</div>
                            <div class="card-value" id="starting-capital-display">$0.00</div>
                        </div>
                    </div>

                    <div class="metric-card portfolio-card">
                        <div class="card-icon">üí∞</div>
                        <div class="card-content">
                            <div class="card-label">Current Balance</div>
                            <div class="card-value" id="current-balance-display">$0.00</div>
                        </div>
                    </div>

                    <div class="metric-card portfolio-card">
                        <div class="card-icon">üìà</div>
                        <div class="card-content">
                            <div class="card-label">Total Return</div>
                            <div class="card-value" id="total-return-display">$0.00</div>
                        </div>
                    </div>

                    <div class="metric-card portfolio-card">
                        <div class="card-icon">üìä</div>
                        <div class="card-content">
                            <div class="card-label">Return %</div>
                            <div class="card-value" id="return-percentage-display">0%</div>
                        </div>
                    </div>

                    <div class="metric-card portfolio-card">
                        <div class="card-icon">üìâ</div>
                        <div class="card-content">
                            <div class="card-label">Max Drawdown</div>
                            <div class="card-value" id="max-drawdown-display">0%</div>
                        </div>
                    </div>

                    <div class="metric-card portfolio-card">
                        <div class="card-icon">üèîÔ∏è</div>
                        <div class="card-content">
                            <div class="card-label">Peak Balance</div>
                            <div class="card-value" id="max-balance-display">$0.00</div>
                        </div>
                    </div>

                    <div class="metric-card portfolio-card">
                        <div class="card-icon">üìè</div>
                        <div class="card-content">
                            <div class="card-label">Sharpe Ratio</div>
                            <div class="card-value" id="sharpe-ratio-display">0.00</div>
                        </div>
                    </div>

                    <div class="metric-card portfolio-card">
                        <div class="card-icon">üìÖ</div>
                        <div class="card-content">
                            <div class="card-label">Trading Days</div>
                            <div class="card-value" id="trading-days-display">0</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Balance Update -->
                <div class="balance-update-section">
                    <h3>‚ö° Quick Balance Update</h3>
                    <form id="balance-update-form" class="balance-update-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="balance-amount">Amount</label>
                                <input type="number" id="balance-amount" step="0.01" placeholder="Enter amount (+/-)">
                            </div>
                            <div class="form-group">
                                <label for="balance-type">Type</label>
                                <select id="balance-type">
                                    <option value="deposit">üí∞ Deposit</option>
                                    <option value="withdrawal">üí∏ Withdrawal</option>
                                    <option value="adjustment">üîß Manual Adjustment</option>
                                    <option value="fee">üí≥ Fee/Commission</option>
                                    <option value="interest">üíπ Interest/Dividend</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="balance-note">Note (Optional)</label>
                                <input type="text" id="balance-note" placeholder="Reason for update">
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-primary">Update Balance</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ========================================
             ADD TRADE TAB
             ======================================== -->
        <div id="add-trade-tab" class="tab-content">
            <div class="form-section">
                <h2>‚ûï Add New Trade</h2>
                <form id="add-trade-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="trade-date">Trade Date *</label>
                            <input type="date" id="trade-date" name="trade-date" required>
                        </div>
                        <div class="form-group">
                            <label for="ticker">Ticker *</label>
                            <input type="text" id="ticker" name="ticker" required placeholder="SPY" style="text-transform: uppercase;">
                        </div>
                        <div class="form-group">
                            <label for="strategy">Strategy *</label>
                            <select id="strategy" name="strategy" required>
                                <option value="">Select Strategy</option>
                                <option value="Call Spread">Call Spread</option>
                                <option value="Put Spread">Put Spread</option>
                                <option value="Iron Condor">Iron Condor</option>
                                <option value="Single Leg">Single Leg</option>
                                <option value="Long Put">Long Put</option>
                                <option value="Long Call">Long Call</option>
                                <option value="Short Call">Short Call</option>
                                <option value="Short Put">Short Put</option>
                                <option value="Straddle">Straddle</option>
                                <option value="Strangle">Strangle</option>
                                <option value="Butterfly">Butterfly</option>
                                <option value="Condor">Condor</option>
                                <option value="Calendar">Calendar</option>
                                <option value="Diagonal">Diagonal</option>
                                <option value="Multi-leg">Multi-leg</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="option-type">Option Type</label>
                            <select id="option-type" name="option-type">
                                <option value="CALL">CALL</option>
                                <option value="PUT">PUT</option>
                                <option value="CALL/PUT">CALL/PUT</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="strike">Strike</label>
                            <input type="text" id="strike" name="strike" placeholder="450 or 450/460">
                        </div>
                        <div class="form-group">
                            <label for="expiration">Expiration</label>
                            <input type="date" id="expiration" name="expiration">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="quantity">Quantity *</label>
                            <input type="number" id="quantity" name="quantity" required min="1" value="1">
                        </div>
                        <div class="form-group">
                            <label for="entry-price">Entry Price</label>
                            <input type="number" id="entry-price" name="entry-price" step="0.01" placeholder="Price per contract">
                        </div>
                        <div class="form-group">
                            <label for="exit-price">Exit Price</label>
                            <input type="number" id="exit-price" name="exit-price" step="0.01" placeholder="Price per contract">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="premium">Premium *</label>
                            <input type="number" id="premium" name="premium" required step="0.01" value="0" placeholder="Total premium">
                        </div>
                        <div class="form-group">
                            <label for="fees">Fees</label>
                            <input type="number" id="fees" name="fees" step="0.01" value="-0.65" placeholder="Commission and fees">
                        </div>
                        <div class="form-group">
                            <!-- Spacer -->
                        </div>
                    </div>

                    <h3 style="color: #00ff88; margin: 20px 0 10px 0;">Greeks (Optional)</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="delta">Delta</label>
                            <input type="number" id="delta" name="delta" step="0.01" placeholder="0.50" min="-1" max="1">
                        </div>
                        <div class="form-group">
                            <label for="gamma">Gamma</label>
                            <input type="number" id="gamma" name="gamma" step="0.01" placeholder="0.05" min="0" max="1">
                        </div>
                        <div class="form-group">
                            <label for="theta">Theta</label>
                            <input type="number" id="theta" name="theta" step="0.01" placeholder="-0.05" min="-1" max="0">
                        </div>
                        <div class="form-group">
                            <label for="vega">Vega</label>
                            <input type="number" id="vega" name="vega" step="0.01" placeholder="0.15" min="0" max="1">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="trade-notes">Trade Notes</label>
                        <textarea id="trade-notes" name="trade-notes" rows="3" placeholder="Add notes about this trade..."></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary">üíæ Add Trade</button>
                </form>
            </div>
        </div>

        <!-- ========================================
             TRADE HISTORY TAB
             ======================================== -->
        <div id="history-tab" class="tab-content">
            <!-- Filters Section -->
            <div class="filters-section">
                <h3>üîç Filters</h3>
                <div class="filters-row">
                    <div class="form-group">
                        <label for="filter-ticker">Ticker</label>
                        <select id="filter-ticker">
                            <option value="">All Tickers</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filter-strategy">Strategy</label>
                        <select id="filter-strategy">
                            <option value="">All Strategies</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filter-date-from">Date From</label>
                        <input type="date" id="filter-date-from">
                    </div>
                    <div class="form-group">
                        <label for="filter-date-to">Date To</label>
                        <input type="date" id="filter-date-to">
                    </div>
                    <div class="form-group">
                        <button id="reset-filters" class="btn btn-secondary">Reset Filters</button>
                    </div>
                </div>
            </div>

            <!-- Bulk Actions -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <div id="table-info"></div>
                <div>
                    <select id="bulk-actions" class="btn btn-secondary">
                        <option value="">Bulk Actions</option>
                        <option value="delete">Delete Selected</option>
                        <option value="clear-all">Clear All Trades</option>
                    </select>
                </div>
            </div>

            <!-- Trade History Table -->
            <div class="table-container">
                <table id="trades-table">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="select-all"></th>
                            <th>Date</th>
                            <th>Ticker</th>
                            <th>Strategy</th>
                            <th>Type</th>
                            <th>Strike</th>
                            <th>Entry</th>
                            <th>Exit</th>
                            <th>Premium</th>
                            <th>Net P&L</th>
                            <th>Outcome</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Trades will be inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ========================================
             IMPORT/EXPORT TAB
             ======================================== -->
        <div id="import-tab" class="tab-content">
            <!-- Import Section -->
            <div class="import-section">
                <h2>üì• Import Trades from CSV</h2>
                <p>Upload a CSV file with your trades. File should include columns: date, ticker, strategy, net_pl, outcome</p>
                
                <div class="form-group">
                    <label for="csv-file">Select CSV File</label>
                    <input type="file" id="csv-file" accept=".csv">
                </div>

                <div style="margin: 1rem 0;">
                    <h4>Import Mode:</h4>
                    <label style="margin-right: 1rem;">
                        <input type="radio" name="import-mode" value="append" checked>
                        Append to existing trades
                    </label>
                    <label>
                        <input type="radio" name="import-mode" value="replace">
                        Replace all trades
                    </label>
                </div>

                <div id="import-message"></div>

                <!-- Preview Section -->
                <div id="preview-section" style="display: none; margin-top: 2rem;">
                    <h3>Preview Import</h3>
                    <div id="preview-status" style="margin-bottom: 1rem;"></div>
                    <div id="preview-table"></div>
                    <button id="commit-import" class="btn btn-primary" style="margin-top: 1rem;">
                        üíæ COMMIT & SAVE
                    </button>
                </div>
            </div>

            <!-- Export Section -->
            <div class="export-section">
                <h2>üì§ Export Trades</h2>
                <p>Download your trades as a CSV file for backup or analysis</p>
                <button class="btn btn-primary" onclick="alert('Export functionality coming soon!')">
                    üì• Export to CSV
                </button>
            </div>
        </div>
    </div>

    <!-- ========================================
         EDIT TRADE MODAL
         ======================================== -->
    <div id="edit-trade-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úèÔ∏è Edit Trade</h2>
                <span class="close-modal" onclick="app.closeEditModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="edit-trade-form">
                    <input type="hidden" id="edit-trade-id">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-trade-date">Trade Date *</label>
                            <input type="date" id="edit-trade-date" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-ticker">Ticker *</label>
                            <input type="text" id="edit-ticker" required style="text-transform: uppercase;">
                        </div>
                        <div class="form-group">
                            <label for="edit-strategy">Strategy *</label>
                            <select id="edit-strategy" required>
                                <option value="">Select Strategy</option>
                                <option value="Call Spread">Call Spread</option>
                                <option value="Put Spread">Put Spread</option>
                                <option value="Iron Condor">Iron Condor</option>
                                <option value="Single Leg">Single Leg</option>
                                <option value="Long Put">Long Put</option>
                                <option value="Long Call">Long Call</option>
                                <option value="Short Call">Short Call</option>
                                <option value="Short Put">Short Put</option>
                                <option value="Straddle">Straddle</option>
                                <option value="Strangle">Strangle</option>
                                <option value="Butterfly">Butterfly</option>
                                <option value="Condor">Condor</option>
                                <option value="Calendar">Calendar</option>
                                <option value="Diagonal">Diagonal</option>
                                <option value="Multi-leg">Multi-leg</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-option-type">Option Type</label>
                            <select id="edit-option-type">
                                <option value="CALL">CALL</option>
                                <option value="PUT">PUT</option>
                                <option value="CALL/PUT">CALL/PUT</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-strike">Strike</label>
                            <input type="text" id="edit-strike" placeholder="450 or 450/460">
                        </div>
                        <div class="form-group">
                            <label for="edit-expiration">Expiration</label>
                            <input type="date" id="edit-expiration">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-quantity">Quantity *</label>
                            <input type="number" id="edit-quantity" required min="1" value="1">
                        </div>
                        <div class="form-group">
                            <label for="edit-entry-price">Entry Price</label>
                            <input type="number" id="edit-entry-price" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="edit-exit-price">Exit Price</label>
                            <input type="number" id="edit-exit-price" step="0.01">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-premium">Premium *</label>
                            <input type="number" id="edit-premium" required step="0.01" value="0">
                        </div>
                        <div class="form-group">
                            <label for="edit-fees">Fees</label>
                            <input type="number" id="edit-fees" step="0.01" value="-0.65">
                        </div>
                        <div class="form-group">
                            <!-- Spacer -->
                        </div>
                    </div>

                    <h3 style="color: #00ff88; margin: 20px 0 10px 0;">Greeks (Optional)</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-delta">Delta</label>
                            <input type="number" id="edit-delta" step="0.01" min="-1" max="1">
                        </div>
                        <div class="form-group">
                            <label for="edit-gamma">Gamma</label>
                            <input type="number" id="edit-gamma" step="0.01" min="0" max="1">
                        </div>
                        <div class="form-group">
                            <label for="edit-theta">Theta</label>
                            <input type="number" id="edit-theta" step="0.01" min="-1" max="0">
                        </div>
                        <div class="form-group">
                            <label for="edit-vega">Vega</label>
                            <input type="number" id="edit-vega" step="0.01" min="0" max="1">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="edit-trade-notes">Trade Notes</label>
                        <textarea id="edit-trade-notes" rows="3"></textarea>
                    </div>

                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">üíæ Save Changes</button>
                        <button type="button" class="btn btn-secondary" onclick="app.closeEditModal()">‚ùå Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
<!-- View Trade Details Modal -->
<div id="view-trade-modal" class="modal">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h2>üëÅÔ∏è Trade Details</h2>
            <button class="close-btn" onclick="app.closeViewModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div id="view-details-content">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="app.closeViewModal()">Close</button>
        </div>
    </div>
</div>

    
    <!-- ========================================
         PORTFOLIO SETTINGS MODAL
         ======================================== -->
    <div id="portfolio-settings-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üíº Portfolio Settings</h2>
                <span class="close-modal" onclick="app.closePortfolioModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="portfolio-settings-form">
                    <div class="form-group">
                        <label for="starting-capital">Starting Capital *</label>
                        <input type="number" id="starting-capital" name="starting-capital" step="0.01" required placeholder="Enter your initial capital">
                        <small class="form-help">This is your initial account balance when you started trading</small>
                    </div>

                    <div class="form-group">
                        <label for="current-balance">Current Balance *</label>
                        <input type="number" id="current-balance" name="current-balance" step="0.01" required placeholder="Enter your current account balance">
                        <small class="form-help">This will be updated automatically as you add trades</small>
                    </div>

                    <div class="portfolio-info-box">
                        <h4>üìä How Portfolio Tracking Works:</h4>
                        <ul>
                            <li>üè¶ <strong>Starting Capital:</strong> Your initial account balance</li>
                            <li>üí∞ <strong>Current Balance:</strong> Updates automatically with trade P&L</li>
                            <li>üìà <strong>Total Return:</strong> Current Balance - Starting Capital</li>
                            <li>üìä <strong>Return %:</strong> (Total Return / Starting Capital) √ó 100</li>
                            <li>üìâ <strong>Max Drawdown:</strong> Largest peak-to-valley decline</li>
                            <li>üìè <strong>Sharpe Ratio:</strong> Risk-adjusted return metric</li>
                        </ul>
                    </div>

                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">üíæ Save Portfolio Settings</button>
                        <button type="button" class="btn btn-secondary" onclick="app.closePortfolioModal()">‚ùå Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ========================================
         SCRIPTS - CRITICAL ORDER!
         ======================================== -->
    <!-- IndexedDB Library -->
    <script src="https://cdn.jsdelivr.net/npm/idb@7.1.1/build/umd.js"></script>
    
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Chart.js Date Adapter -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <!-- Main Application Script -->
    <script src="app.js"></script>
</body>
</html>
